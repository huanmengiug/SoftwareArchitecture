<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>后台管理系统</title>
  <link rel="icon" href="favicon.ico" type="image/ico">
  <meta name="keywords" content="LightYear">
  <meta name="description" content="后台管理系统">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/materialdesignicons.min.css" rel="stylesheet">
  <link href="css/style.min.css" rel="stylesheet">
</head>

<body>
  <div class="lyear-layout-web">
    <div class="lyear-layout-container">
      <!--左侧导航-->
      <aside class="lyear-layout-sidebar">

        <!-- logo -->
        <div id="logo" class="sidebar-header">
          <a href="index.html"><img src="images/logo-sidebar.png" title="LightYear" alt="LightYear" /></a>
        </div>
        <div class="lyear-layout-sidebar-scroll">

          <nav class="sidebar-main">
            <ul class="nav nav-drawer">
              <li class="nav-item active"> <a href="index.html"><i class="mdi mdi-home"></i> 后台首页</a> </li>
              <li class="nav-item nav-item-has-subnav">
                <a href="javascript:void(0)"><i class="mdi mdi-palette"></i> 员工信息</a>
                <ul class="nav nav-subnav">
                  <li> <a href="lyear_ui_buttons.html">按钮</a> </li>
                  <li> <a href="lyear_ui_cards.html">卡片</a> </li>
                  <li> <a href="lyear_ui_grid.html">格栅</a> </li>
                  <li> <a href="lyear_ui_icons.html">图标</a> </li>
                  <li> <a href="lyear_ui_tables.html">表格</a> </li>
                  <li> <a href="lyear_ui_modals.html">模态框</a> </li>
                  <li> <a href="lyear_ui_tooltips_popover.html">提示 / 弹出框</a> </li>
                  <li> <a href="lyear_ui_alerts.html">警告框</a> </li>
                  <li> <a href="lyear_ui_pagination.html">分页</a> </li>
                  <li> <a href="lyear_ui_progress.html">进度条</a> </li>
                  <li> <a href="lyear_ui_tabs.html">标签页</a> </li>
                  <li> <a href="lyear_ui_typography.html">排版</a> </li>
                  <li> <a href="lyear_ui_step.html">步骤</a> </li>
                  <li> <a href="lyear_ui_other.html">其他</a> </li>
                </ul>
              </li>
              <li class="nav-item nav-item-has-subnav">
                <a href="javascript:void(0)"><i class="mdi mdi-format-align-justify"></i> 表单管理</a>
                <ul class="nav nav-subnav">
                  <li> <a href="lyear_forms_elements.html">基本元素</a> </li>
                  <li> <a href="lyear_forms_radio.html">单选框</a> </li>
                  <li> <a href="lyear_forms_checkbox.html">复选框</a> </li>
                  <li> <a href="lyear_forms_switch.html">开关</a> </li>
                </ul>
              </li>
              <li class="nav-item nav-item-has-subnav">
                <a href="javascript:void(0)"><i class="mdi mdi-file-outline"></i> 主页</a>
                <ul class="nav nav-subnav">
                  <li> <a href="lyear_pages_doc.html">文档列表</a> </li>
                  <li> <a href="lyear_pages_gallery.html">图库列表</a> </li>
                  <li> <a href="lyear_pages_config.html">网站配置</a> </li>
                  <li> <a href="lyear_pages_rabc.html">设置权限</a> </li>
                  <li> <a href="lyear_pages_add_doc.html">新增文档</a> </li>
                  <li> <a href="lyear_pages_guide.html">表单向导</a> </li>
                  <li> <a href="lyear_pages_login.html">登录页面</a> </li>
                  <li> <a href="lyear_pages_login_2.html">登录页面2</a> </li>
                  <li> <a href="lyear_pages_login_3.html">登录页面3</a> </li>
                  <li> <a href="lyear_pages_login_4.html">登录页面4</a> </li>
                  <li> <a href="lyear_pages_error.html">错误页面</a> </li>
                </ul>
              </li>

            </ul>
          </nav>

        </div>

      </aside>
      <!--End 左侧导航-->

      <!--头部信息-->
      <header class="lyear-layout-header">

        <nav class="navbar navbar-default">
          <div class="topbar">

            <div class="topbar-left">
              <div class="lyear-aside-toggler">
                <span class="lyear-toggler-bar"></span>
                <span class="lyear-toggler-bar"></span>
                <span class="lyear-toggler-bar"></span>
              </div>
              <span class="navbar-page-title"> 后台首页 </span>
            </div>

            <ul class="topbar-right">
              <li class="dropdown dropdown-profile">
                <a href="javascript:void(0)" data-toggle="dropdown">
                  <img class="img-avatar img-avatar-48 m-r-10" src="images/users/avatar.jpg" alt="笔下光年" />
                  <span>CPA<span class="caret"></span></span>
                </a>
                <ul class="dropdown-menu dropdown-menu-right">
                  <li> <a href="lyear_pages_profile.html"><i class="mdi mdi-account"></i> 个人信息</a> </li>
                  <li> <a href="lyear_pages_edit_pwd.html"><i class="mdi mdi-lock-outline"></i> 修改密码</a> </li>
                  <li> <a href="javascript:void(0)"><i class="mdi mdi-delete"></i> 清空缓存</a></li>
                  <li class="divider"></li>
                  <li> <a href="lyear_pages_login.html"><i class="mdi mdi-logout-variant"></i> 退出登录</a> </li>
                </ul>
              </li>
              <!--切换主题配色-->
              <li class="dropdown dropdown-skin">
                <span data-toggle="dropdown" class="icon-palette"><i class="mdi mdi-palette"></i></span>
                <ul class="dropdown-menu dropdown-menu-right" data-stopPropagation="true">
                  <li class="drop-title">
                    <p>主题</p>
                  </li>
                  <li class="drop-skin-li clearfix">
                    <span class="inverse">
                      <input type="radio" name="site_theme" value="default" id="site_theme_1" checked>
                      <label for="site_theme_1"></label>
                    </span>
                    <span>
                      <input type="radio" name="site_theme" value="dark" id="site_theme_2">
                      <label for="site_theme_2"></label>
                    </span>
                    <span>
                      <input type="radio" name="site_theme" value="translucent" id="site_theme_3">
                      <label for="site_theme_3"></label>
                    </span>
                  </li>
                  <li class="drop-title">
                    <p>LOGO</p>
                  </li>
                  <li class="drop-skin-li clearfix">
                    <span class="inverse">
                      <input type="radio" name="logo_bg" value="default" id="logo_bg_1" checked>
                      <label for="logo_bg_1"></label>
                    </span>
                    <span>
                      <input type="radio" name="logo_bg" value="color_2" id="logo_bg_2">
                      <label for="logo_bg_2"></label>
                    </span>
                    <span>
                      <input type="radio" name="logo_bg" value="color_3" id="logo_bg_3">
                      <label for="logo_bg_3"></label>
                    </span>
                    <span>
                      <input type="radio" name="logo_bg" value="color_4" id="logo_bg_4">
                      <label for="logo_bg_4"></label>
                    </span>
                    <span>
                      <input type="radio" name="logo_bg" value="color_5" id="logo_bg_5">
                      <label for="logo_bg_5"></label>
                    </span>
                    <span>
                      <input type="radio" name="logo_bg" value="color_6" id="logo_bg_6">
                      <label for="logo_bg_6"></label>
                    </span>
                    <span>
                      <input type="radio" name="logo_bg" value="color_7" id="logo_bg_7">
                      <label for="logo_bg_7"></label>
                    </span>
                    <span>
                      <input type="radio" name="logo_bg" value="color_8" id="logo_bg_8">
                      <label for="logo_bg_8"></label>
                    </span>
                  </li>
                  <li class="drop-title">
                    <p>头部</p>
                  </li>
                  <li class="drop-skin-li clearfix">
                    <span class="inverse">
                      <input type="radio" name="header_bg" value="default" id="header_bg_1" checked>
                      <label for="header_bg_1"></label>
                    </span>
                    <span>
                      <input type="radio" name="header_bg" value="color_2" id="header_bg_2">
                      <label for="header_bg_2"></label>
                    </span>
                    <span>
                      <input type="radio" name="header_bg" value="color_3" id="header_bg_3">
                      <label for="header_bg_3"></label>
                    </span>
                    <span>
                      <input type="radio" name="header_bg" value="color_4" id="header_bg_4">
                      <label for="header_bg_4"></label>
                    </span>
                    <span>
                      <input type="radio" name="header_bg" value="color_5" id="header_bg_5">
                      <label for="header_bg_5"></label>
                    </span>
                    <span>
                      <input type="radio" name="header_bg" value="color_6" id="header_bg_6">
                      <label for="header_bg_6"></label>
                    </span>
                    <span>
                      <input type="radio" name="header_bg" value="color_7" id="header_bg_7">
                      <label for="header_bg_7"></label>
                    </span>
                    <span>
                      <input type="radio" name="header_bg" value="color_8" id="header_bg_8">
                      <label for="header_bg_8"></label>
                    </span>
                  </li>
                  <li class="drop-title">
                    <p>侧边栏</p>
                  </li>
                  <li class="drop-skin-li clearfix">
                    <span class="inverse">
                      <input type="radio" name="sidebar_bg" value="default" id="sidebar_bg_1" checked>
                      <label for="sidebar_bg_1"></label>
                    </span>
                    <span>
                      <input type="radio" name="sidebar_bg" value="color_2" id="sidebar_bg_2">
                      <label for="sidebar_bg_2"></label>
                    </span>
                    <span>
                      <input type="radio" name="sidebar_bg" value="color_3" id="sidebar_bg_3">
                      <label for="sidebar_bg_3"></label>
                    </span>
                    <span>
                      <input type="radio" name="sidebar_bg" value="color_4" id="sidebar_bg_4">
                      <label for="sidebar_bg_4"></label>
                    </span>
                    <span>
                      <input type="radio" name="sidebar_bg" value="color_5" id="sidebar_bg_5">
                      <label for="sidebar_bg_5"></label>
                    </span>
                    <span>
                      <input type="radio" name="sidebar_bg" value="color_6" id="sidebar_bg_6">
                      <label for="sidebar_bg_6"></label>
                    </span>
                    <span>
                      <input type="radio" name="sidebar_bg" value="color_7" id="sidebar_bg_7">
                      <label for="sidebar_bg_7"></label>
                    </span>
                    <span>
                      <input type="radio" name="sidebar_bg" value="color_8" id="sidebar_bg_8">
                      <label for="sidebar_bg_8"></label>
                    </span>
                  </li>
                </ul>
              </li>
              <!--切换主题配色-->
            </ul>

          </div>
        </nav>

      </header>
      <!--End 头部信息-->

      <!--页面主要内容-->
      <main class="lyear-layout-content">

        <div class="container-fluid">

          <div class="row">
            <div class="col-sm-6 col-lg-6">
              <div class="card bg-primary">
                <div class="card-body clearfix">
                  <div class="pull-right">
                    <p class="h6 text-white m-t-0">收入</p>
                    <p class="h3 text-white m-b-0 fa-1-5x" id="in"></p>
                  </div>
                  <div class="pull-left"> <span class="img-avatar img-avatar-48 bg-translucent"><i
                        class="mdi mdi-currency-cny fa-1-5x"></i></span> </div>
                </div>
              </div>
            </div>

            <div class="col-sm-6 col-lg-6">
              <div class="card bg-danger">
                <div class="card-body clearfix">
                  <div class="pull-right">
                    <p class="h6 text-white m-t-0">支出</p>
                    <p class="h3 text-white m-b-0 fa-1-5x" id="out"></p>
                  </div>
                  <div class="pull-left"> <span class="img-avatar img-avatar-48 bg-translucent"><i
                        class="mdi mdi-account fa-1-5x"></i></span> </div>
                </div>
              </div>
            </div>
            <div style="display: none;" class="alert alert-info alert-dismissible" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                  aria-hidden="true">&times;</span></button>
              <h4>老板只关注一共花了多少钱以及一共收入多少钱，其余并不关心</h4>
              <p>老板查看一共收入多少/老板查看一共花费多少(所有工资合并)</p>
            </div>
            <div style="display: none;" class="alert alert-info alert-dismissible" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                  aria-hidden="true">&times;</span></button>
              <h4>财务主管对每一个单子都要核对项目和金额</h4>
              <p>财务主管查看账本时，每一个都核对项目和金额</p>
            </div>
            <div class="alert alert-info alert-dismissible" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                  aria-hidden="true">&times;</span></button>
              <h4>注册会计师（CPA）在看账本时，如果是支出，则如果支出是工资，则需要看应该交的税交了没</h4>
              <p>注册会计师查看账本时，如果单子的消费目的是发工资，则注会会查看有没有交个人所得税</p>
              <p>注册会计师查看账本时，只要是收入，注会都要查看公司交税了没</p>
            </div>


            <div class="row">

              <div class="col-lg-6">
                <div class="card">
                  <div class="card-header">
                    <h4>月收入</h4>
                  </div>
                  <div id="inlist"></div>
                </div>
              </div>

              <div class="col-lg-6">
                <div class="card">
                  <div class="card-header">
                    <h4>月支出</h4>
                  </div>
                  <div id="outlist"></div>
                </div>
              </div>

            </div>

            <div class="row">

              <div class="col-lg-6">
                <div class="card">
                  <div class="card-header">
                    <h4>收入</h4>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th>#</th>
                            <th>项目名称</th>
                            <th>金额</th>
                            <th>日期</th>
                            <th>状态</th>
                          </tr>
                        </thead>
                        <tbody id="in_tab">
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-6">
                <div class="card">
                  <div class="card-header">
                    <h4>支出</h4>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th>#</th>
                            <th>项目名称</th>
                            <th>金额</th>
                            <th>日期</th>
                            <th>状态</th>
                          </tr>
                        </thead>
                        <tbody id="out_tab">
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

            </div>

          </div>

      </main>
      <!--End 页面主要内容-->
    </div>
  </div>

  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/perfect-scrollbar.min.js"></script>
  <script type="text/javascript" src="js/main.min.js"></script>

  <!--图表插件-->
  <script type="text/javascript" src="./js/echarts.js"></script>
  <script type="text/javascript">
    let ddra = true;
    let cash = [];
    const viewer = 'CPA';
    $.ajax({
      async: false,
      url: 'http://127.0.0.1:8088/data',
      data: { viewer },
      type: 'GET',
      dataType: 'json',
      success: function (data) {
        console.log(data)
        inlist(standard_data(data['in']));
        outlist(standard_data(data['out']));
        inlab(data['in'])
        outlab(data['out'])
        $("#in").text(cash[0]);
        $("#out").text(cash[1]);
      },
      error: function (err) {
        window.alert("信息回传失败（；´д｀）ゞ");
      }
    });

    function standard_data(data) {
      var re_data = [];
      var gz_flag = -1;
      var sum = 0;
      for (var d of data) {
        if (viewer === "Boss") {
          var patt = new RegExp("工资");
          if (patt.test(d.tag)) {
            if (gz_flag === -1) {
              gz_flag = re_data.length;
              re_data[re_data.length] = { value: parseFloat(d.money), name: "工资" };
            } else {
              re_data[gz_flag].value += parseFloat(d.money);
            }
          } else {
            re_data[re_data.length] = { value: d.money, name: d.tag };
          }
        } else {
          re_data[re_data.length] = { value: d.money, name: d.tag };
        }
        sum += parseFloat(d.money);
      }
      cash[cash.length] = sum;
      return re_data
    }

    function MsgSort(obj){
      obj.sort((a, b) => {
        let t1 = new Date(Date.parse(a.time.replace(/-/g, "/")))
        let t2 = new Date(Date.parse(b.time.replace(/-/g, "/")))
        return t2.getTime() - t1.getTime()
      })
      return obj
    }


    function inlab(in_data) {
      var lab = $("#in_tab");
      var arr = []

      // 将需要排序的 key, 按照 "从小到大" 进行排列
      arr = MsgSort(in_data)


      var lab_tag = ['label-warning', 'label-success', 'label-danger'], labTag = ['待定', '进行中', '未开始'];
      var td;
      for (var i in in_data) {
        var rand = Math.round(Math.random() * (lab_tag.length - 1));
        td = "<tr>\n" +
          "<td>" + (parseInt(i) + 1) + "</td>\n" +
          "<td>" + in_data[i].tag + "</td>\n" +
          "<td>" + in_data[i].money + "</td>\n" +
          "<td>" + in_data[i].time + "</td>\n" +
          "<td><span class='label " + lab_tag[rand] + "'>" + labTag[rand] + "</span></td>\n" +
          "</tr>"
        lab.append($(td))
      }
    }
    function outlab(out_data) {
      var lab = $("#out_tab");
      var arr = []

      arr = MsgSort(out_data)

      var lab_tag = ['label-warning', 'label-success', 'label-danger'], labTag = ['待定', '进行中', '未开始'];
      var td;
      for (var i in out_data) {
        var rand = Math.round(Math.random() * (lab_tag.length - 1));
        td = "<tr>\n" +
          "<td>" + (parseInt(i) + 1) + "</td>\n" +
          "<td>" + out_data[i].tag + "</td>\n" +
          "<td>" + out_data[i].money + "</td>\n" +
          "<td>" + out_data[i].time + "</td>\n" +
          "<td><span class='label " + lab_tag[rand] + "'>" + labTag[rand] + "</span></td>\n" +
          "</tr>"
        lab.append($(td))
      }
    }

    function inlist(in_data) {
      var chartDom = document.getElementById('inlist');
      chartDom.style.minWidth = '100px';
      chartDom.style.minHeight = '550px';


      if (myChart != null && myChart != "" && myChart != undefined) {
        myChart.dispose();
      }

      var myChart = echarts.init(chartDom);
      var option = {
        legend: {
          top: 'top'
        },
        toolbox: {
          show: true,
          feature: {
            mark: { show: true },
            dataView: { show: true, readOnly: false },
            restore: { show: true },
            saveAsImage: { show: true }
          }
        },
        series: [
          {
            name: 'Nightingale Chart',
            type: 'pie',
            radius: [50, 250],
            center: ['50%', '50%'],
            roseType: 'area',
            itemStyle: {
              borderRadius: 8
            },
            data: in_data
          }
        ]
      };
      option && myChart.setOption(option);
    }
    function outlist(out_data) {
      var chartDom = document.getElementById('outlist');
      chartDom.style.minWidth = '100px';
      chartDom.style.minHeight = '550px';


      if (myChart != null && myChart != "" && myChart != undefined) {
        myChart.dispose();
      }

      var myChart = echarts.init(chartDom);
      var option = {
        legend: {
          top: 'top'
        },
        toolbox: {
          show: true,
          feature: {
            mark: { show: true },
            dataView: { show: true, readOnly: false },
            restore: { show: true },
            saveAsImage: { show: true }
          }
        },
        series: [
          {
            name: 'Nightingale Chart',
            type: 'pie',
            radius: [50, 250],
            center: ['50%', '50%'],
            roseType: 'area',
            itemStyle: {
              borderRadius: 8
            },
            data: out_data
          }
        ]
      };
      option && myChart.setOption(option);
    }

  </script>
</body>

</html>